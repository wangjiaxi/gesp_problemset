<!--pages/history/history.wxml-->
<view class="container">
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics-container" wx:if="{{!isEmpty && !loading}}">
    <view class="stats-header">
      <text class="stats-title">åˆ·é¢˜ç»Ÿè®¡</text>
      <text class="clear-btn" bindtap="onClearHistory">æ¸…ç©ºè®°å½•</text>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalQuestions}}</text>
        <text class="stat-label">æ€»é¢˜æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number correct">{{statistics.correctCount}}</text>
        <text class="stat-label">æ­£ç¡®</text>
      </view>
      <view class="stat-item">
        <text class="stat-number wrong">{{statistics.wrongCount}}</text>
        <text class="stat-label">é”™è¯¯</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.accuracy}}%</text>
        <text class="stat-label">æ­£ç¡®ç‡</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-container" wx:if="{{!isEmpty && !loading}}">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="onTabChange" data-tab="0">
      <text>å…¨éƒ¨({{historyList.length}})</text>
    </view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="onTabChange" data-tab="1">
      <text>æ­£ç¡®({{statistics.correctCount}})</text>
    </view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="onTabChange" data-tab="2">
      <text>é”™è¯¯({{statistics.wrongCount}})</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{isEmpty && !loading}}">
    <view class="empty-icon">ğŸ“Š</view>
    <text class="empty-title">æš‚æ— åˆ·é¢˜è®°å½•</text>
    <text class="empty-desc">å¼€å§‹åˆ·é¢˜æ¥è®°å½•ä½ çš„å­¦ä¹ è½¨è¿¹å§</text>
    <button class="go-browse-btn" bindtap="goToBrowse">å¼€å§‹åˆ·é¢˜</button>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view class="history-list" wx:if="{{!isEmpty && !loading}}">
    <view 
      class="history-item" 
      wx:for="{{filteredList}}" 
      wx:key="id"
      bindtap="onQuestionTap"
      data-question-id="{{item.questionId}}">
      
      <!-- ç»“æœæ ‡è¯† -->
      <view class="result-indicator {{item.isCorrect ? 'correct' : 'wrong'}}">
        <text class="result-icon">{{item.isCorrect ? 'âœ“' : 'âœ—'}}</text>
      </view>

      <!-- é¢˜ç›®å†…å®¹ -->
      <view class="question-content">
        <view class="question-header">
          <view class="question-meta">
            <text class="question-type">{{item.type === 'choice' ? 'é€‰æ‹©é¢˜' : item.type === 'judge' ? 'åˆ¤æ–­é¢˜' : 'ç¼–ç¨‹é¢˜'}}</text>
            <text class="question-level">Level {{item.level}}</text>
            <text class="question-difficulty">{{item.difficulty === 1 ? 'â˜…â˜†â˜†â˜†â˜†' : item.difficulty === 2 ? 'â˜…â˜…â˜†â˜†â˜†' : item.difficulty === 3 ? 'â˜…â˜…â˜…â˜†â˜†' : item.difficulty === 4 ? 'â˜…â˜…â˜…â˜…â˜†' : 'â˜…â˜…â˜…â˜…â˜…'}}</text>
          </view>
          <view class="answer-time">{{item.answerTime}}</view>
        </view>
        
        <view class="question-text">{{item.question}}</view>
        
        <view class="answer-info">
          <view class="answer-row">
            <text class="answer-label">ä½ çš„ç­”æ¡ˆï¼š</text>
            <text class="user-answer {{item.isCorrect ? 'correct' : 'wrong'}}">{{item.userAnswer}}</text>
          </view>
          <view class="answer-row" wx:if="{{!item.isCorrect}}">
            <text class="answer-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
            <text class="correct-answer">{{item.correctAnswer}}</text>
          </view>
          <view class="answer-row">
            <text class="answer-label">ç”¨æ—¶ï¼š</text>
            <text class="time-spent">{{item.timeSpent < 60 ? item.timeSpent + 'ç§’' : Math.floor(item.timeSpent / 60) + 'åˆ†' + (item.timeSpent % 60) + 'ç§’'}}</text>
          </view>
        </view>
        
        <view class="question-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºç­›é€‰ç»“æœ -->
    <view class="empty-filter" wx:if="{{filteredList.length === 0}}">
      <text class="empty-filter-text">æš‚æ— {{currentTab === 1 ? 'æ­£ç¡®' : 'é”™è¯¯'}}è®°å½•</text>
    </view>
  </view>
</view>