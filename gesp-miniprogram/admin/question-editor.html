<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GESPé¢˜ç›®ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #4169E1 0%, #6A5ACD 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4169E1;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #4169E1;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3557C7;
        }

        .btn-success {
            background-color: #52C41A;
            color: white;
        }

        .btn-success:hover {
            background-color: #45A617;
        }

        .btn-danger {
            background-color: #FF4D4F;
            color: white;
        }

        .btn-danger:hover {
            background-color: #E63946;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .options-container {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .option-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .option-key {
            width: 40px;
            text-align: center;
            font-weight: bold;
            color: #4169E1;
        }

        .option-input {
            flex: 1;
        }

        .questions-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 10px;
        }

        .question-item {
            padding: 10px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .question-item:hover {
            background-color: #f8f9fa;
            border-color: #4169E1;
        }

        .question-item.active {
            background-color: #e3f2fd;
            border-color: #4169E1;
        }

        .question-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .question-meta {
            font-size: 12px;
            color: #666;
        }

        .file-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .file-info h3 {
            color: #4169E1;
            margin-bottom: 10px;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ GESPé¢˜ç›®ç¼–è¾‘å™¨</h1>
            <p>è½»æ¾ç®¡ç†å’Œç¼–è¾‘GESPè€ƒè¯•é¢˜ç›®</p>
        </div>

        <div class="main-content">
            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <div class="form-group">
                    <label>é€‰æ‹©è€ƒè¯•åœºæ¬¡</label>
                    <div class="form-row">
                        <select id="examYear">
                            <option value="2023">2023å¹´</option>
                            <option value="2024">2024å¹´</option>
                            <option value="2025">2025å¹´</option>
                        </select>
                        <select id="examMonth">
                            <option value="03">3æœˆ</option>
                            <option value="06">6æœˆ</option>
                            <option value="09">9æœˆ</option>
                            <option value="12">12æœˆ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>ç­‰çº§</label>
                    <select id="examLevel">
                        <option value="1">ä¸€çº§</option>
                        <option value="2">äºŒçº§</option>
                        <option value="3">ä¸‰çº§</option>
                        <option value="4">å››çº§</option>
                        <option value="5">äº”çº§</option>
                        <option value="6">å…­çº§</option>
                        <option value="7">ä¸ƒçº§</option>
                        <option value="8">å…«çº§</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="loadExamFile()" style="width: 100%; margin-bottom: 20px;">
                    ğŸ“‚ åŠ è½½è€ƒè¯•æ–‡ä»¶
                </button>

                <div id="fileInfo" class="file-info hidden">
                    <h3>å½“å‰æ–‡ä»¶</h3>
                    <p id="fileName"></p>
                    <p id="questionCount"></p>
                </div>

                <div class="form-group">
                    <label>é¢˜ç›®åˆ—è¡¨</label>
                    <div id="questionsList" class="questions-list">
                        <p style="text-align: center; color: #666; padding: 20px;">è¯·å…ˆåŠ è½½è€ƒè¯•æ–‡ä»¶</p>
                    </div>
                </div>

                <button class="btn btn-success" onclick="addNewQuestion()" style="width: 100%; margin-bottom: 10px;">
                    â• æ·»åŠ æ–°é¢˜ç›®
                </button>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="content">
                <div id="alertContainer"></div>

                <form id="questionForm">
                    <div class="form-group">
                        <label>é¢˜ç›®ID</label>
                        <input type="text" id="questionId" placeholder="å¦‚: 202303C1_01" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>é¢˜ç›®ç±»å‹</label>
                            <select id="questionType" onchange="toggleOptions()">
                                <option value="choice">é€‰æ‹©é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>éš¾åº¦ç­‰çº§</label>
                            <select id="questionDifficulty">
                                <option value="1">ç®€å•</option>
                                <option value="2">ä¸­ç­‰</option>
                                <option value="3">å›°éš¾</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>é¢˜ç›®å†…å®¹</label>
                        <textarea id="questionContent" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..." required></textarea>
                    </div>

                    <div id="optionsContainer" class="form-group">
                        <label>é€‰é¡¹è®¾ç½®</label>
                        <div class="options-container">
                            <div class="option-item">
                                <span class="option-key">A</span>
                                <input type="text" class="option-input" id="optionA" placeholder="é€‰é¡¹Aå†…å®¹">
                            </div>
                            <div class="option-item">
                                <span class="option-key">B</span>
                                <input type="text" class="option-input" id="optionB" placeholder="é€‰é¡¹Bå†…å®¹">
                            </div>
                            <div class="option-item">
                                <span class="option-key">C</span>
                                <input type="text" class="option-input" id="optionC" placeholder="é€‰é¡¹Cå†…å®¹">
                            </div>
                            <div class="option-item">
                                <span class="option-key">D</span>
                                <input type="text" class="option-input" id="optionD" placeholder="é€‰é¡¹Då†…å®¹">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>æ­£ç¡®ç­”æ¡ˆ</label>
                        <select id="questionAnswer">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ç­”æ¡ˆè§£æ</label>
                        <textarea id="questionExplanation" placeholder="è¯·è¾“å…¥ç­”æ¡ˆè§£æ..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)</label>
                        <input type="text" id="questionTags" placeholder="å¦‚: å˜é‡å£°æ˜, åŸºç¡€è¯­æ³•">
                    </div>

                    <div class="actions">
                        <button type="button" class="btn btn-success" onclick="saveQuestion()">
                            ğŸ’¾ ä¿å­˜é¢˜ç›®
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteQuestion()">
                            ğŸ—‘ï¸ åˆ é™¤é¢˜ç›®
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">
                            ğŸ”„ æ¸…ç©ºè¡¨å•
                        </button>
                        <button type="button" class="btn btn-primary" onclick="exportJSON()">
                            ğŸ“¥ å¯¼å‡ºJSON
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentExamData = null;
        let currentQuestionIndex = -1;

        // åˆ‡æ¢é€‰é¡¹æ˜¾ç¤º
        function toggleOptions() {
            const type = document.getElementById('questionType').value;
            const optionsContainer = document.getElementById('optionsContainer');
            const answerSelect = document.getElementById('questionAnswer');
            
            if (type === 'choice') {
                optionsContainer.style.display = 'block';
                answerSelect.innerHTML = `
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                `;
            } else {
                optionsContainer.style.display = 'none';
                answerSelect.innerHTML = `
                    <option value="true">æ­£ç¡®</option>
                    <option value="false">é”™è¯¯</option>
                `;
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    ${message}
                </div>
            `;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 3000);
        }

        // åŠ è½½è€ƒè¯•æ–‡ä»¶
        function loadExamFile() {
            const year = document.getElementById('examYear').value;
            const month = document.getElementById('examMonth').value;
            const level = document.getElementById('examLevel').value;
            
            const fileName = `${year}${month}C${level}.json`;
            
            // åˆ›å»ºé»˜è®¤çš„è€ƒè¯•æ•°æ®ç»“æ„
            currentExamData = {
                examInfo: {
                    year: parseInt(year),
                    month: parseInt(month),
                    language: "C++",
                    level: parseInt(level),
                    examDate: `${year}-${month}-15`,
                    duration: level <= 2 ? 60 : 75,
                    totalQuestions: 15,
                    passingScore: 60
                },
                questions: []
            };
            
            // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
            document.getElementById('fileName').textContent = fileName;
            document.getElementById('questionCount').textContent = `é¢˜ç›®æ•°é‡: ${currentExamData.questions.length}`;
            document.getElementById('fileInfo').classList.remove('hidden');
            
            // æ›´æ–°é¢˜ç›®åˆ—è¡¨
            updateQuestionsList();
            
            showAlert(`å·²åˆ›å»º/åŠ è½½æ–‡ä»¶: ${fileName}`);
        }

        // æ›´æ–°é¢˜ç›®åˆ—è¡¨
        function updateQuestionsList() {
            const questionsList = document.getElementById('questionsList');
            
            if (!currentExamData || currentExamData.questions.length === 0) {
                questionsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">æš‚æ— é¢˜ç›®</p>';
                return;
            }
            
            let html = '';
            currentExamData.questions.forEach((question, index) => {
                const isActive = index === currentQuestionIndex ? 'active' : '';
                html += `
                    <div class="question-item ${isActive}" onclick="selectQuestion(${index})">
                        <div class="question-title">${question.id}</div>
                        <div class="question-meta">
                            ${question.type === 'choice' ? 'é€‰æ‹©é¢˜' : 'åˆ¤æ–­é¢˜'} | 
                            éš¾åº¦: ${question.difficulty} | 
                            ${question.question.substring(0, 30)}...
                        </div>
                    </div>
                `;
            });
            
            questionsList.innerHTML = html;
            
            // æ›´æ–°é¢˜ç›®æ•°é‡
            document.getElementById('questionCount').textContent = `é¢˜ç›®æ•°é‡: ${currentExamData.questions.length}`;
        }

        // é€‰æ‹©é¢˜ç›®
        function selectQuestion(index) {
            currentQuestionIndex = index;
            const question = currentExamData.questions[index];
            
            // å¡«å……è¡¨å•
            document.getElementById('questionId').value = question.id;
            document.getElementById('questionType').value = question.type;
            document.getElementById('questionDifficulty').value = question.difficulty;
            document.getElementById('questionContent').value = question.question;
            document.getElementById('questionAnswer').value = question.answer;
            document.getElementById('questionExplanation').value = question.explanation;
            document.getElementById('questionTags').value = question.tags.join(', ');
            
            // å¡«å……é€‰é¡¹
            if (question.type === 'choice' && question.options) {
                question.options.forEach(option => {
                    const input = document.getElementById(`option${option.key}`);
                    if (input) input.value = option.value;
                });
            }
            
            toggleOptions();
            updateQuestionsList();
        }

        // æ·»åŠ æ–°é¢˜ç›®
        function addNewQuestion() {
            if (!currentExamData) {
                showAlert('è¯·å…ˆåŠ è½½è€ƒè¯•æ–‡ä»¶', 'error');
                return;
            }
            
            currentQuestionIndex = -1;
            clearForm();
            
            // è‡ªåŠ¨ç”Ÿæˆé¢˜ç›®ID
            const year = currentExamData.examInfo.year;
            const month = currentExamData.examInfo.month.toString().padStart(2, '0');
            const level = currentExamData.examInfo.level;
            const questionNum = (currentExamData.questions.length + 1).toString().padStart(2, '0');
            
            document.getElementById('questionId').value = `${year}${month}C${level}_${questionNum}`;
        }

        // ä¿å­˜é¢˜ç›®
        function saveQuestion() {
            if (!currentExamData) {
                showAlert('è¯·å…ˆåŠ è½½è€ƒè¯•æ–‡ä»¶', 'error');
                return;
            }
            
            const questionData = {
                id: document.getElementById('questionId').value,
                type: document.getElementById('questionType').value,
                question: document.getElementById('questionContent').value,
                options: [],
                answer: document.getElementById('questionAnswer').value,
                explanation: document.getElementById('questionExplanation').value,
                difficulty: parseInt(document.getElementById('questionDifficulty').value),
                tags: document.getElementById('questionTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                points: 2
            };
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!questionData.id || !questionData.question || !questionData.answer || !questionData.explanation) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            // å¤„ç†é€‰é¡¹
            if (questionData.type === 'choice') {
                const options = ['A', 'B', 'C', 'D'];
                options.forEach(key => {
                    const value = document.getElementById(`option${key}`).value;
                    if (value) {
                        questionData.options.push({ key, value });
                    }
                });
                
                if (questionData.options.length < 2) {
                    showAlert('é€‰æ‹©é¢˜è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹', 'error');
                    return;
                }
            }
            
            // ä¿å­˜æˆ–æ›´æ–°é¢˜ç›®
            if (currentQuestionIndex >= 0) {
                currentExamData.questions[currentQuestionIndex] = questionData;
                showAlert('é¢˜ç›®æ›´æ–°æˆåŠŸ');
            } else {
                currentExamData.questions.push(questionData);
                showAlert('é¢˜ç›®æ·»åŠ æˆåŠŸ');
            }
            
            updateQuestionsList();
        }

        // åˆ é™¤é¢˜ç›®
        function deleteQuestion() {
            if (currentQuestionIndex < 0) {
                showAlert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                currentExamData.questions.splice(currentQuestionIndex, 1);
                currentQuestionIndex = -1;
                clearForm();
                updateQuestionsList();
                showAlert('é¢˜ç›®åˆ é™¤æˆåŠŸ');
            }
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('questionForm').reset();
            currentQuestionIndex = -1;
            toggleOptions();
            updateQuestionsList();
        }

        // å¯¼å‡ºJSON
        function exportJSON() {
            if (!currentExamData) {
                showAlert('è¯·å…ˆåŠ è½½è€ƒè¯•æ–‡ä»¶', 'error');
                return;
            }
            
            const year = document.getElementById('examYear').value;
            const month = document.getElementById('examMonth').value;
            const level = document.getElementById('examLevel').value;
            const fileName = `${year}${month}C${level}.json`;
            
            const jsonString = JSON.stringify(currentExamData, null, 2);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert(`JSONæ–‡ä»¶å·²å¯¼å‡º: ${fileName}`);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            toggleOptions();
        });
    </script>
</body>
</html>