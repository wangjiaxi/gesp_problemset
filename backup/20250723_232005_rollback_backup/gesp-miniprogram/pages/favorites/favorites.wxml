<!--pages/favorites/favorites.wxml-->
<view class="container">
  <!-- å·¥å…·æ  -->
  <view class="toolbar" wx:if="{{favoriteList.length > 0}}">
    <view class="toolbar-left">
      <text class="count-text">å…±{{favoriteList.length}}é“é¢˜ç›®</text>
    </view>
    <view class="toolbar-right">
      <text class="edit-btn" bindtap="toggleEditMode">
        {{editMode ? 'å–æ¶ˆ' : 'ç®¡ç†'}}
      </text>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡å¼å·¥å…·æ  -->
  <view class="edit-toolbar" wx:if="{{editMode}}">
    <view class="edit-actions">
      <text class="select-all-btn" bindtap="onSelectAll">
        {{selectedItems.length === favoriteList.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
      </text>
      <text class="delete-btn" bindtap="onDeleteSelected">
        åˆ é™¤é€‰ä¸­({{selectedItems.length}})
      </text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{isEmpty && !loading}}">
    <view class="empty-icon">ğŸ“š</view>
    <text class="empty-title">æš‚æ— æ”¶è—é¢˜ç›®</text>
    <text class="empty-desc">å»é¢˜åº“æ”¶è—ä¸€äº›é¢˜ç›®å§</text>
    <button class="go-browse-btn" bindtap="goToBrowse">å»åˆ·é¢˜</button>
  </view>

  <!-- æ”¶è—åˆ—è¡¨ -->
  <view class="favorite-list" wx:if="{{!isEmpty && !loading}}">
    <view 
      class="question-item {{editMode ? 'edit-mode' : ''}}" 
      wx:for="{{favoriteList}}" 
      wx:key="id"
      bindtap="{{editMode ? 'onSelectItem' : 'onQuestionTap'}}"
      data-id="{{item.id}}">
      
      <!-- é€‰æ‹©æ¡† -->
      <view class="select-box" wx:if="{{editMode}}">
        <view class="checkbox {{selectedItems.indexOf(item.id) > -1 ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{selectedItems.indexOf(item.id) > -1}}">âœ“</text>
        </view>
      </view>

      <!-- é¢˜ç›®å†…å®¹ -->
      <view class="question-content">
        <view class="question-header">
          <view class="question-meta">
            <text class="question-type">{{item.type === 'choice' ? 'é€‰æ‹©é¢˜' : item.type === 'judge' ? 'åˆ¤æ–­é¢˜' : 'ç¼–ç¨‹é¢˜'}}</text>
            <text class="question-level">Level {{item.level}}</text>
            <text class="question-difficulty">{{item.difficulty === 1 ? 'â˜…â˜†â˜†â˜†â˜†' : item.difficulty === 2 ? 'â˜…â˜…â˜†â˜†â˜†' : item.difficulty === 3 ? 'â˜…â˜…â˜…â˜†â˜†' : item.difficulty === 4 ? 'â˜…â˜…â˜…â˜…â˜†' : 'â˜…â˜…â˜…â˜…â˜…'}}</text>
          </view>
          <view class="favorite-time">{{item.favoriteTime}}</view>
        </view>
        
        <view class="question-text">{{item.question}}</view>
        
        <view class="question-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="question-actions" wx:if="{{!editMode}}">
        <text class="unfavorite-btn" bindtap="onUnfavorite" data-id="{{item.id}}" catchtap="true">å–æ¶ˆæ”¶è—</text>
      </view>
    </view>
  </view>
</view>